<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Power Consumption Visualization</title>
  <link rel="stylesheet" type="text/css" href="/css" />
  <link rel="stylesheet" type="text/css" href="/css/prime-ui" />
  
  <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>
  <script src="/js/prime-ui"></script>
  <script>
  var circuitNameToIndex = {"c1":0, "c2":1, "c3":2, "c4":3, "c5":4, "c6":5, "c7a":6, "c7b":7, "c8":8, "c9":9, "c10":10, "c11":11, "c12":12, "c13":13, "c14":14, "c15":15, "c16":16, "c17":17, "c18":18, "c19":19, "c20": 20};	
  var selectedCircuits = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];
  var maxCircuitValue = 0;
  	$.getJSON("/data/circuitMax").done(function(data){
  		$.each(data[0], function (i, d){
  			console.log(d);
  			maxCircuitValue = Math.max(d, maxCircuitValue);
  		});
  	}).then(function(data){
  		$.getJSON("/data/powerEvents").done(function(events)
	  	{
	  		var startTimeRange = new Date(events[0].start);
	  		var endTimeRange = new Date(events[events.length - 1].end);
	  		var rangeInMilliseconds = endTimeRange.getTime() - startTimeRange.getTime();
	  		
	  		var canvas = document.getElementById("overviewBackground");
	  		var context = canvas.getContext("2d");

	  		$.each(events, function(i, d){
	  			var x = ((new Date(d.start).getTime() - startTimeRange.getTime()) / rangeInMilliseconds) * canvas.width;
	  			var y = circuitNameToIndex[d.circuit] * (canvas.height / selectedCircuits.length);
	  			var w = ((new Date(d.end).getTime() - new Date(d.start).getTime()) / rangeInMilliseconds) * canvas.width;
	  			var h = (canvas.height / selectedCircuits.length);
	  			context.fillStyle = "rgba(0,0,0," + (d.avgKW / maxCircuitValue) * (w/canvas.width) + ")";
	  	  		context.fillRect(x,y,w,h);
	  		});
	  	});	
  	});
  	
  	$(document).ready( function(){
  		$("#circuitSelector input").puicheckbox();
  		$("#startDate").datepicker();
  	  	$("#endDate").datepicker();
  	});
  	
  	
  	
  	/*	.attr("x", function(d){
  			console.log(((new Date(d.start).getTime() - startTimeRange.getTime()) / rangeInMilliseconds) * ovWidth);
  			return ((new Date(d.start).getTime() - startTimeRange.getTime()) / rangeInMilliseconds) * ovWidth;
  		})
  		.attr("y", 0)
  		.attr("width", function(d){
  			return ((new Date(d.end).getTime() - new Date(d.end).getTime()) / rangeInMilliseconds) * ovWidth;
  		})
  		.attr("height", 5)
  		.attr("style", function(d) {"fill: " + d3.hsl(30, 1, d.c1)});
  	});*/
  	
  </script>
</head>
<body>

<div id="visualizationContainer">
    <div id="visTopContainer">
        <div id="circuitGraph">
            
        </div>
        <div id="circuitLevels">
            
        </div>
        <div id="circuitQuery">
        </div>
    </div>
    <div id="visBottomContainer">
        <div id="overviewContainer">
            <div id="options">
				Start Date: <input type="text" id="startDate" /><br/>
				End Date: <input type="text" id="endDate" />
            </div>
            <div id="overview">
            	<canvas id="overviewBackground"></canvas>
            </div>
        </div>
        <div id="zoomContainer">
            <div id="labels">
            </div>
            <div id="zoomView">
            </div>
        </div>
    </div>
</div>

<div id="circuitSelector">
	<input type="checkbox" value="0" /> Circuit 1
	<input type="checkbox" value="1" /> Circuit 2
	<input type="checkbox" value="2" /> Circuit 3
	<input type="checkbox" value="3" /> Circuit 4
	<input type="checkbox" value="4" /> Circuit 5
	<input type="checkbox" value="5" /> Circuit 6
	<input type="checkbox" value="6" /> Circuit 7A
	<input type="checkbox" value="7" /> Circuit 7B
	<input type="checkbox" value="8" /> Circuit 8
	<input type="checkbox" value="9" /> Circuit 9
	<input type="checkbox" value="10" /> Circuit 10
	<input type="checkbox" value="11" /> Circuit 11
	<input type="checkbox" value="12" /> Circuit 12
	<input type="checkbox" value="13" /> Circuit 13
	<input type="checkbox" value="14" /> Circuit 14
	<input type="checkbox" value="15" /> Circuit 15
	<input type="checkbox" value="16" /> Circuit 16
	<input type="checkbox" value="17" /> Circuit 17
	<input type="checkbox" value="18" /> Circuit 18
	<input type="checkbox" value="19" /> Circuit 19
	<input type="checkbox" value="20" /> Circuit 20
</div>

</body>
</html>
